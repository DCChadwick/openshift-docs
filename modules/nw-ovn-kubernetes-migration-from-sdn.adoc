// Module included in the following assemblies:
//
// * networking/ovn_kubernetes_network_provider/ovn-kubernetes-migration.adoc

:_mod-docs-content-type: PROCEDURE
[id="nw-ovn-kubernetes-migration-from-sdn_{context}"]
= Migrating to the OVN-Kubernetes plugin from the OpenShift SDN network plugin

Before migrating from the OpenShift SDN network plugin to the OVN-Kubernetes plugin, follow these best practices: 

.Prerequisites

. Check your environment.
+
* Ensure that your cluster is installed on infrastructure capable of supporting the OVN-Kubernetes network plugin. 
* Verify that your cluster is in a stable state without errors. All operators should be healthy, and all nodes must be ready. 
* Confirm that your cluster is not currently upgrading. Additionally, all nodes should be on the same version.
* Ensure that your cluster nodes have no IP address conflicts.
* Back up your cluster.
* Verify that your MTU settings are adjusted correctly. Note that migration will change the MTU from 1450 in SDN to 1400 in OVN-Kubernetes. 

. Configure the UDP packet.
+
* For all platforms, ensure that port 6081 on all nodes allows UDP packets.
** For cloud platforms, ensure that the appropriate security group rule is in place. 
** For on-premises and bare-metal platforms, open UDP port 6081 in the firewall with high priority. 

. Address third-party webhook issues.
+
* Identify and resolve any third-party webhook issues that might cause migration failure. 
* Back up webhook and temporarily delete it if necessary. 

. Note the ranges for OVN-Kubernetes IP addresses.
+
* The OVN-Kubernetes IP address ranges are `100.64.0.0/16`, `169.254.169.0/29`, `100.88.0.0/16`, `fd98::/64`, `fd69::/125`, and `fd97::/64`. Avoid using these IP ranges in any other CIDR definitions. 

. Configurae the control plane.
+
* If you are using the secondary interface IP to configure the control plane nodes, verify that the OVN interface has a default gateway. 

. Configure the `NODEIP_HINT` variable.
+
* If you have not configured the `NODEIP_HINT` variable, OVN will set up its bridge on the default interface. 

. Configure clusters that use static routes:
+
* For clusters that rely on static routes aand routing policies in the host network, set the `routingViaHost` variable to `true`.
* Set `ipForwarding` to Global in the `gatewayConfig` variable during migration to offload routing decisions to the host kernel.

.Procedure

Apply the following patch before the 5th step in the SDN to OVN migration documentation:

[source,terminal]
----
$ oc patch Network.operator.openshift.io cluster --type=merge / --patch '{ 
    "spec": { 
      "defaultNetwork": {
        "ovnKubernetesConfig": { 
          "gatewayConfig": { 
            "ipForwarding": "Global", 
            "routingViaHost": true 
    }}}}}'
----